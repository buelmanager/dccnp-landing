---
/**
 * FAQ Section
 * Accordion with GSAP height animation
 */

const faqs = [
  { q: '배송은 얼마나 걸리나요?', a: '경기도 파주 물류센터에서 출고되며, 수도권은 1-2일, 지방은 2-3일 소요됩니다.' },
  { q: 'B2B 대량 구매 할인이 있나요?', a: '네, 대량 구매 시 별도 견적을 제공해 드립니다. 온라인 견적 서비스를 이용해 주세요.' },
  { q: '중고/리퍼비시 제품의 품질은?', a: '25년 노하우로 엄격한 품질 검수를 거쳐 판매됩니다. 품질 보증 제공.' },
  { q: '세금계산서 발행이 가능한가요?', a: '네, 사업자 고객님께 세금계산서 발행이 가능합니다.' },
  { q: '반품/교환 정책은?', a: '제품 수령 후 7일 이내 미개봉 제품에 한해 반품/교환 가능합니다.' },
];
---

<section class="faq" id="faq">
  <!-- Background -->
  <div class="faq__bg">
    <div class="faq__bg-gradient"></div>
    <div class="faq__bg-pattern"></div>
  </div>

  <div class="faq__container">
    <!-- Header -->
    <header class="faq__header" data-faq-header>
      <span class="faq__label">FAQ</span>
      <h2 class="faq__title">자주 묻는 질문</h2>
      <p class="faq__description">
        고객님들이 가장 많이 궁금해하시는 질문들을 모았습니다
      </p>
    </header>

    <!-- Accordion List -->
    <div class="faq__list" data-faq-list>
      {faqs.map((faq, index) => (
        <article 
          class="faq__item" 
          data-faq-item 
          style={`--delay: ${index * 0.1}s`}
        >
          <button 
            class="faq__question" 
            type="button"
            aria-expanded="false"
            data-faq-trigger
          >
            <span class="faq__question-text">{faq.q}</span>
            <span class="faq__icon" aria-hidden="true">
              <span class="faq__icon-line faq__icon-line--h"></span>
              <span class="faq__icon-line faq__icon-line--v"></span>
            </span>
          </button>
          <div class="faq__answer" data-faq-answer>
            <div class="faq__answer-inner">
              <p>{faq.a}</p>
            </div>
          </div>
        </article>
      ))}
    </div>

    <!-- CTA -->
    <div class="faq__cta" data-faq-cta>
      <p class="faq__cta-text">찾으시는 답변이 없으신가요?</p>
      <a href="#contact" class="button button--outline">
        <span>문의하기</span>
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
          <path d="M3 8h10M9 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<style>
  .faq {
    position: relative;
    padding: var(--space-4xl) 0;
    overflow: hidden;
    background: var(--background);
  }

  /* Background Effects */
  .faq__bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
    z-index: 0;
  }

  .faq__bg-gradient {
    position: absolute;
    inset: 0;
    background: 
      radial-gradient(ellipse 60% 40% at 30% 100%, rgba(26, 54, 93, 0.12) 0%, transparent 50%),
      radial-gradient(ellipse 50% 30% at 70% 0%, rgba(49, 130, 206, 0.08) 0%, transparent 50%);
  }

  .faq__bg-pattern {
    position: absolute;
    inset: 0;
    opacity: 0.02;
    background-image: 
      linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
    background-size: 80px 80px;
  }

  /* Container */
  .faq__container {
    position: relative;
    z-index: 1;
    max-width: 900px;
    margin: 0 auto;
    padding: 0 var(--container-padding);
  }

  /* Header */
  .faq__header {
    text-align: center;
    margin-bottom: var(--space-3xl);
    opacity: 0;
    transform: translateY(30px);
  }

  .faq__header.is-visible {
    opacity: 1;
    transform: translateY(0);
    transition: 
      opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1),
      transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .faq__label {
    display: inline-block;
    font-size: var(--font-size-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-wider);
    color: var(--accent);
    margin-bottom: var(--space-md);
    padding: var(--space-xs) var(--space-lg);
    background: rgba(99, 179, 237, 0.1);
    border: 1px solid rgba(99, 179, 237, 0.2);
    border-radius: var(--radius-full);
  }

  .faq__title {
    font-size: var(--font-size-4xl);
    font-weight: 600;
    line-height: var(--line-height-tight);
    letter-spacing: var(--letter-spacing-tight);
    color: var(--text-primary);
    margin-bottom: var(--space-lg);
  }

  .faq__description {
    font-size: var(--font-size-lg);
    color: var(--text-secondary);
    line-height: var(--line-height-relaxed);
    max-width: 480px;
    margin: 0 auto;
  }

  /* List */
  .faq__list {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  /* Item */
  .faq__item {
    position: relative;
    background: linear-gradient(
      135deg,
      rgba(26, 54, 93, 0.06) 0%,
      rgba(17, 17, 17, 0.4) 100%
    );
    border-radius: var(--radius-lg);
    border: 1px solid rgba(255, 255, 255, 0.05);
    overflow: hidden;
    opacity: 0;
    transform: translateY(20px);
    transition: 
      border-color var(--transition-base),
      box-shadow var(--transition-base);
  }

  .faq__item.is-visible {
    opacity: 1;
    transform: translateY(0);
    transition: 
      opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1) var(--delay),
      transform 0.6s cubic-bezier(0.16, 1, 0.3, 1) var(--delay),
      border-color var(--transition-base),
      box-shadow var(--transition-base);
  }

  .faq__item:hover {
    border-color: rgba(99, 179, 237, 0.2);
  }

  .faq__item.is-active {
    border-color: rgba(99, 179, 237, 0.3);
    box-shadow: 
      0 10px 40px rgba(0, 0, 0, 0.3),
      0 0 40px rgba(26, 54, 93, 0.15);
  }

  /* Question Button */
  .faq__question {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--space-xl) var(--space-2xl);
    text-align: left;
    cursor: pointer;
    transition: background var(--transition-base);
  }

  .faq__question:hover {
    background: rgba(255, 255, 255, 0.02);
  }

  .faq__question-text {
    font-size: var(--font-size-lg);
    font-weight: 500;
    color: var(--text-primary);
    line-height: var(--line-height-normal);
    padding-right: var(--space-lg);
    transition: color var(--transition-base);
  }

  .faq__item.is-active .faq__question-text {
    color: var(--accent-light);
  }

  /* Icon */
  .faq__icon {
    position: relative;
    flex-shrink: 0;
    width: 24px;
    height: 24px;
  }

  .faq__icon-line {
    position: absolute;
    background: var(--accent);
    border-radius: var(--radius-full);
    transition: 
      transform var(--transition-base),
      opacity var(--transition-base);
  }

  .faq__icon-line--h {
    top: 50%;
    left: 0;
    width: 100%;
    height: 2px;
    transform: translateY(-50%);
  }

  .faq__icon-line--v {
    top: 0;
    left: 50%;
    width: 2px;
    height: 100%;
    transform: translateX(-50%);
  }

  .faq__item.is-active .faq__icon-line--v {
    transform: translateX(-50%) rotate(90deg);
    opacity: 0;
  }

  /* Answer */
  .faq__answer {
    height: 0;
    overflow: hidden;
  }

  .faq__answer-inner {
    padding: 0 var(--space-2xl) var(--space-xl);
  }

  .faq__answer p {
    font-size: var(--font-size-base);
    color: var(--text-secondary);
    line-height: var(--line-height-relaxed);
  }

  /* CTA */
  .faq__cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-lg);
    margin-top: var(--space-3xl);
    padding-top: var(--space-3xl);
    border-top: 1px solid rgba(255, 255, 255, 0.06);
    opacity: 0;
    transform: translateY(20px);
  }

  .faq__cta.is-visible {
    opacity: 1;
    transform: translateY(0);
    transition: 
      opacity 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.3s,
      transform 0.6s cubic-bezier(0.16, 1, 0.3, 1) 0.3s;
  }

  .faq__cta-text {
    font-size: var(--font-size-base);
    color: var(--text-muted);
  }

  .faq__cta .button {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
  }

  .faq__cta .button svg {
    transition: transform var(--transition-base);
  }

  .faq__cta .button:hover svg {
    transform: translateX(4px);
  }

  /* Responsive */
  @media (max-width: 719px) {
    .faq {
      padding: var(--space-3xl) 0;
    }

    .faq__header {
      margin-bottom: var(--space-2xl);
    }

    .faq__title {
      font-size: var(--font-size-2xl);
    }

    .faq__description {
      font-size: var(--font-size-base);
    }

    .faq__question {
      padding: var(--space-lg);
    }

    .faq__question-text {
      font-size: var(--font-size-base);
    }

    .faq__answer-inner {
      padding: 0 var(--space-lg) var(--space-lg);
    }

    .faq__answer p {
      font-size: var(--font-size-sm);
    }
  }

  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .faq__header,
    .faq__item,
    .faq__cta {
      opacity: 1;
      transform: none;
    }
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  function initFAQAnimation() {
    const section = document.querySelector('.faq');
    if (!section) return;

    const header = section.querySelector('[data-faq-header]');
    const items = section.querySelectorAll('[data-faq-item]');
    const cta = section.querySelector('[data-faq-cta]');

    // Header animation
    if (header) {
      ScrollTrigger.create({
        trigger: header,
        start: 'top 85%',
        onEnter: () => header.classList.add('is-visible'),
        once: true,
      });
    }

    // Items animation
    if (items.length) {
      ScrollTrigger.create({
        trigger: section.querySelector('[data-faq-list]'),
        start: 'top 80%',
        onEnter: () => {
          items.forEach((item) => item.classList.add('is-visible'));
        },
        once: true,
      });
    }

    // CTA animation
    if (cta) {
      ScrollTrigger.create({
        trigger: cta,
        start: 'top 90%',
        onEnter: () => cta.classList.add('is-visible'),
        once: true,
      });
    }

    // Accordion functionality
    const triggers = section.querySelectorAll('[data-faq-trigger]');
    
    triggers.forEach((trigger) => {
      trigger.addEventListener('click', () => {
        const item = trigger.closest('[data-faq-item]');
        const answer = item?.querySelector('[data-faq-answer]') as HTMLElement;
        const answerInner = answer?.querySelector('.faq__answer-inner') as HTMLElement;
        const isActive = item?.classList.contains('is-active');

        // Close all other items
        items.forEach((otherItem) => {
          if (otherItem !== item && otherItem.classList.contains('is-active')) {
            const otherAnswer = otherItem.querySelector('[data-faq-answer]') as HTMLElement;
            const otherTrigger = otherItem.querySelector('[data-faq-trigger]');
            
            otherItem.classList.remove('is-active');
            otherTrigger?.setAttribute('aria-expanded', 'false');
            
            gsap.to(otherAnswer, {
              height: 0,
              duration: 0.4,
              ease: 'power3.inOut',
            });
          }
        });

        // Toggle current item
        if (isActive) {
          item?.classList.remove('is-active');
          trigger.setAttribute('aria-expanded', 'false');
          
          gsap.to(answer, {
            height: 0,
            duration: 0.4,
            ease: 'power3.inOut',
          });
        } else {
          item?.classList.add('is-active');
          trigger.setAttribute('aria-expanded', 'true');
          
          const targetHeight = answerInner?.offsetHeight || 0;
          
          gsap.to(answer, {
            height: targetHeight,
            duration: 0.5,
            ease: 'power3.out',
          });
        }
      });
    });
  }

  // Initialize
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFAQAnimation);
  } else {
    initFAQAnimation();
  }

  // Astro page transitions
  document.addEventListener('astro:page-load', initFAQAnimation);
</script>
