---
/**
 * Appliances Section Component
 * Horizontal slider for IT peripherals with GSAP scroll animations
 */

const appliances = [
  { 
    title: '데스크톱 PC', 
    desc: '업무와 게이밍을 위한 고성능 데스크톱 컴퓨터', 
    category: 'desktop',
    image: 'https://images.unsplash.com/photo-1587831990711-23ca6441447b?w=800&q=80'
  },
  { 
    title: '노트북', 
    desc: '어디서나 생산성을 발휘하는 비즈니스 노트북', 
    category: 'laptop',
    image: 'https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=800&q=80'
  },
  { 
    title: '프린터 & 복합기', 
    desc: '오피스 환경에 최적화된 레이저 프린터', 
    category: 'printer',
    image: 'https://images.unsplash.com/photo-1612815154858-60aa4c59eaa6?w=800&q=80'
  },
  { 
    title: '모니터', 
    desc: '선명한 색감과 넓은 시야각의 전문가용 디스플레이', 
    category: 'monitor',
    image: 'https://images.unsplash.com/photo-1527443224154-c4a3942d3acf?w=800&q=80'
  },
  { 
    title: '키보드 & 마우스', 
    desc: '정확한 입력과 편안한 타이핑을 위한 주변기기', 
    category: 'keyboard',
    image: 'https://images.unsplash.com/photo-1587829741301-dc798b83add3?w=800&q=80'
  },
  { 
    title: '스토리지', 
    desc: '안정적인 데이터 저장을 위한 SSD와 외장하드', 
    category: 'storage',
    image: 'https://images.unsplash.com/photo-1597838816882-4435b1977fbe?w=800&q=80'
  },
];
---

<section id="appliances" class="section-appliances" data-appliances>
  <!-- Background Elements -->
  <div class="appliances-bg">
    <div class="appliances-bg-gradient"></div>
    <div class="appliances-bg-noise"></div>
    <div class="appliances-bg-lines"></div>
  </div>

  <!-- Section Header -->
  <div class="appliances-header" data-appliances-header>
    <span class="appliances-eyebrow">
      <span class="appliances-eyebrow-line"></span>
      <span class="appliances-eyebrow-text">IT PERIPHERALS</span>
    </span>
    <h2 class="appliances-title">
      <span class="appliances-title-line">업무 효율을 높이는</span>
      <span class="appliances-title-line appliances-title-accent">주변기기</span>
    </h2>
    <p class="appliances-desc">
      프리미엄 IT 주변기기로 완벽한 워크스테이션을 구축하세요
    </p>
  </div>

  <!-- Slider Container -->
  <div class="appliances-slider-container">
    <!-- Progress Bar -->
    <div class="appliances-progress">
      <div class="appliances-progress-track">
        <div class="appliances-progress-fill" data-progress-fill></div>
      </div>
      <div class="appliances-progress-info">
        <span class="appliances-progress-current" data-progress-current>01</span>
        <span class="appliances-progress-divider">/</span>
        <span class="appliances-progress-total">06</span>
      </div>
    </div>

    <!-- Slider -->
    <div class="appliances-slider" data-appliances-slider>
      <div class="appliances-track" data-appliances-track>
        {appliances.map((item, index) => (
          <article class="appliance-slide" data-slide data-category={item.category}>
            <div class="appliance-inner">
              <!-- Content Side -->
              <div class="appliance-content">
                <span class="appliance-index">0{index + 1}</span>
                <h3 class="appliance-title">{item.title}</h3>
                <p class="appliance-desc">{item.desc}</p>
                <a href={`#${item.category}`} class="appliance-link">
                  <span>자세히 보기</span>
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                    <path d="M4 10h12M12 6l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
              </div>

               <!-- Image Side -->
               <div class="appliance-image">
                 <div class="appliance-image-inner">
                   <!-- Product Image -->
                   <img 
                     src={item.image} 
                     alt={item.title}
                     class="appliance-image-bg"
                   />
                   
                   <!-- Dark Overlay for Icon Visibility -->
                   <div class="appliance-image-overlay"></div>
                   <div class="appliance-image-grid"></div>
                   
                  <!-- Category Icon -->
                    <div class="appliance-icon">
                    {item.category === 'desktop' && (
                      <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="8" y="6" width="32" height="24" rx="2"/>
                        <path d="M16 36h16"/>
                        <path d="M24 30v6"/>
                        <path d="M12 36h24v4H12z"/>
                      </svg>
                    )}
                    {item.category === 'laptop' && (
                      <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M8 32V12a2 2 0 012-2h28a2 2 0 012 2v20"/>
                        <path d="M4 32h40l-4 8H8l-4-8z"/>
                        <rect x="12" y="14" width="24" height="14" rx="1"/>
                      </svg>
                    )}
                    {item.category === 'printer' && (
                      <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="12" y="4" width="24" height="12"/>
                        <rect x="6" y="16" width="36" height="18" rx="2"/>
                        <rect x="12" y="34" width="24" height="10"/>
                        <circle cx="36" cy="22" r="2"/>
                      </svg>
                    )}
                    {item.category === 'monitor' && (
                      <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="4" y="6" width="40" height="28" rx="2"/>
                        <path d="M18 40h12"/>
                        <path d="M24 34v6"/>
                        <rect x="8" y="10" width="32" height="20" rx="1"/>
                      </svg>
                    )}
                    {item.category === 'keyboard' && (
                      <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="4" y="14" width="40" height="20" rx="3"/>
                        <path d="M10 20h4M18 20h4M26 20h4M34 20h4"/>
                        <path d="M10 26h4M18 26h4M26 26h4M34 26h4"/>
                        <path d="M14 32h20"/>
                      </svg>
                    )}
                    {item.category === 'storage' && (
                      <svg viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="8" y="8" width="32" height="8" rx="2"/>
                        <rect x="8" y="20" width="32" height="8" rx="2"/>
                        <rect x="8" y="32" width="32" height="8" rx="2"/>
                        <circle cx="14" cy="12" r="1.5" fill="currentColor"/>
                        <circle cx="14" cy="24" r="1.5" fill="currentColor"/>
                        <circle cx="14" cy="36" r="1.5" fill="currentColor"/>
                      </svg>
                    )}
                  </div>

                  <!-- Floating Elements -->
                  <div class="appliance-float appliance-float-1"></div>
                  <div class="appliance-float appliance-float-2"></div>
                </div>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>

    <!-- Navigation -->
    <div class="appliances-nav" data-appliances-nav>
      <button class="appliances-nav-btn appliances-nav-prev" data-nav-prev aria-label="이전 슬라이드">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M15 6l-6 6 6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
      <button class="appliances-nav-btn appliances-nav-next" data-nav-next aria-label="다음 슬라이드">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M9 6l6 6-6 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Slide Indicators -->
  <div class="appliances-indicators" data-appliances-indicators>
    {appliances.map((_, index) => (
      <button 
        class={`appliances-indicator ${index === 0 ? 'active' : ''}`}
        data-indicator={index}
        aria-label={`슬라이드 ${index + 1}로 이동`}
      >
        <span class="appliances-indicator-fill"></span>
      </button>
    ))}
  </div>
</section>

<style>
  /* Section Base */
  .section-appliances {
    position: relative;
    min-height: 100vh;
    padding: var(--space-4xl) 0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  /* Background */
  .appliances-bg {
    position: absolute;
    inset: 0;
    z-index: 0;
    pointer-events: none;
  }

  .appliances-bg-gradient {
    position: absolute;
    inset: 0;
    background: 
      radial-gradient(ellipse 60% 40% at 80% 20%, rgba(26, 54, 93, 0.25) 0%, transparent 60%),
      radial-gradient(ellipse 50% 50% at 20% 80%, rgba(49, 130, 206, 0.15) 0%, transparent 50%),
      linear-gradient(180deg, var(--background) 0%, rgba(10, 10, 10, 1) 100%);
  }

  .appliances-bg-noise {
    position: absolute;
    inset: 0;
    opacity: 0.025;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
  }

  .appliances-bg-lines {
    position: absolute;
    inset: 0;
    background-image: 
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 120px,
        rgba(255, 255, 255, 0.015) 120px,
        rgba(255, 255, 255, 0.015) 121px
      );
  }

  /* Header */
  .appliances-header {
    position: relative;
    z-index: 1;
    max-width: var(--container-max);
    width: 100%;
    margin: 0 auto;
    padding: 0 var(--container-padding);
    margin-bottom: var(--space-3xl);
    opacity: 0;
    transform: translateY(40px);
  }

  .appliances-eyebrow {
    display: inline-flex;
    align-items: center;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
  }

  .appliances-eyebrow-line {
    width: 32px;
    height: 1px;
    background: linear-gradient(90deg, var(--primary-light), transparent);
  }

  .appliances-eyebrow-text {
    font-size: var(--font-size-xs);
    font-weight: 500;
    letter-spacing: var(--letter-spacing-wider);
    color: var(--primary-light);
  }

  .appliances-title {
    font-size: clamp(2rem, 6vw, var(--font-size-5xl));
    font-weight: 600;
    line-height: 1.1;
    letter-spacing: var(--letter-spacing-tight);
    margin-bottom: var(--space-md);
  }

  .appliances-title-line {
    display: block;
  }

  .appliances-title-accent {
    background: linear-gradient(135deg, var(--text-primary) 0%, var(--primary-light) 50%, var(--accent) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .appliances-desc {
    font-size: var(--font-size-lg);
    color: var(--text-secondary);
    max-width: 480px;
  }

  /* Progress Bar */
  .appliances-progress {
    position: relative;
    z-index: 2;
    max-width: var(--container-max);
    width: 100%;
    margin: 0 auto;
    padding: 0 var(--container-padding);
    margin-bottom: var(--space-xl);
    display: flex;
    align-items: center;
    gap: var(--space-lg);
  }

  .appliances-progress-track {
    flex: 1;
    height: 2px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-full);
    overflow: hidden;
  }

  .appliances-progress-fill {
    width: 16.66%;
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    border-radius: var(--radius-full);
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .appliances-progress-info {
    display: flex;
    align-items: baseline;
    gap: var(--space-xs);
    font-family: var(--font-family);
    font-weight: 500;
    font-variant-numeric: tabular-nums;
  }

  .appliances-progress-current {
    font-size: var(--font-size-xl);
    color: var(--text-primary);
  }

  .appliances-progress-divider {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
  }

  .appliances-progress-total {
    font-size: var(--font-size-sm);
    color: var(--text-muted);
  }

  /* Slider Container */
  .appliances-slider-container {
    position: relative;
    z-index: 1;
  }

  /* Slider */
  .appliances-slider {
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;
    cursor: grab;
  }

  .appliances-slider::-webkit-scrollbar {
    display: none;
  }

  .appliances-slider:active {
    cursor: grabbing;
  }

  .appliances-track {
    display: flex;
    gap: var(--space-lg);
    padding: 0 max(var(--container-padding), calc((100vw - var(--container-max)) / 2 + var(--container-padding)));
  }

  /* Individual Slide */
  .appliance-slide {
    flex: 0 0 min(85vw, 900px);
    scroll-snap-align: start;
    scroll-snap-stop: always;
    opacity: 0;
    transform: translateY(30px);
  }

  .appliance-inner {
    display: grid;
    grid-template-columns: 1fr 1.4fr;
    gap: var(--space-xl);
    height: 100%;
    min-height: 400px;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: var(--radius-xl);
    overflow: hidden;
    transition: all var(--transition-slow);
  }

  .appliance-slide:hover .appliance-inner {
    border-color: rgba(255, 255, 255, 0.12);
    background: rgba(255, 255, 255, 0.04);
  }

  /* Content Side */
  .appliance-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: var(--space-2xl);
    padding-right: 0;
  }

  .appliance-index {
    display: block;
    font-size: var(--font-size-sm);
    font-weight: 500;
    letter-spacing: var(--letter-spacing-wider);
    color: var(--primary-light);
    margin-bottom: var(--space-md);
    opacity: 0.7;
  }

  .appliance-title {
    font-size: clamp(1.5rem, 3vw, var(--font-size-3xl));
    font-weight: 600;
    line-height: 1.2;
    letter-spacing: var(--letter-spacing-tight);
    margin-bottom: var(--space-md);
    color: var(--text-primary);
  }

  .appliance-desc {
    font-size: var(--font-size-base);
    line-height: var(--line-height-relaxed);
    color: var(--text-secondary);
    margin-bottom: var(--space-xl);
    max-width: 280px;
  }

  .appliance-link {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--font-size-sm);
    font-weight: 500;
    letter-spacing: var(--letter-spacing-wide);
    color: var(--text-primary);
    text-transform: uppercase;
    transition: all var(--transition-base);
  }

  .appliance-link svg {
    transition: transform var(--transition-base);
  }

  .appliance-link:hover {
    color: var(--primary-light);
  }

  .appliance-link:hover svg {
    transform: translateX(6px);
  }

  /* Image Side */
  .appliance-image {
    position: relative;
    overflow: hidden;
  }

  .appliance-image-inner {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 400px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform var(--transition-slow);
  }

  .appliance-slide:hover .appliance-image-inner {
    transform: scale(1.02);
  }

   /* Product Image Background */
   .appliance-image-bg {
     position: absolute;
     inset: 0;
     width: 100%;
     height: 100%;
     object-fit: cover;
     object-position: center;
   }

   .appliance-image-overlay {
     position: absolute;
     inset: 0;
     background: linear-gradient(
       135deg,
       rgba(0, 0, 0, 0.3) 0%,
       rgba(0, 0, 0, 0.5) 100%
     );
     pointer-events: none;
   }

  .appliance-image-grid {
    position: absolute;
    inset: 0;
    background-image: 
      linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 30px 30px;
    pointer-events: none;
  }

  /* Category Icon */
  .appliance-icon {
    position: relative;
    z-index: 1;
    width: 120px;
    height: 120px;
    color: rgba(255, 255, 255, 0.85);
    filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.3));
    transition: transform var(--transition-slow);
  }

  .appliance-icon svg {
    width: 100%;
    height: 100%;
  }

  .appliance-slide:hover .appliance-icon {
    transform: scale(1.1) translateY(-5px);
  }

  /* Floating Elements */
  .appliance-float {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    filter: blur(40px);
    pointer-events: none;
  }

  .appliance-float-1 {
    width: 200px;
    height: 200px;
    top: -50px;
    right: -50px;
    animation: float1 8s ease-in-out infinite;
  }

  .appliance-float-2 {
    width: 150px;
    height: 150px;
    bottom: -30px;
    left: -30px;
    animation: float2 10s ease-in-out infinite;
  }

  @keyframes float1 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(-20px, 20px) scale(1.1); }
  }

  @keyframes float2 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(15px, -15px) scale(0.9); }
  }

  /* Navigation */
  .appliances-nav {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100%;
    max-width: calc(var(--container-max) + 120px);
    display: flex;
    justify-content: space-between;
    padding: 0 var(--space-md);
    pointer-events: none;
    z-index: 10;
  }

  .appliances-nav-btn {
    width: 56px;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    color: var(--text-primary);
    cursor: pointer;
    pointer-events: auto;
    transition: all var(--transition-base);
  }

  .appliances-nav-btn:hover {
    border-color: var(--primary);
    background: rgba(26, 54, 93, 0.4);
    transform: scale(1.1);
  }

  .appliances-nav-btn:active {
    transform: scale(0.95);
  }

  .appliances-nav-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    pointer-events: none;
  }

  /* Indicators */
  .appliances-indicators {
    display: flex;
    justify-content: center;
    gap: var(--space-sm);
    margin-top: var(--space-2xl);
    padding: 0 var(--container-padding);
  }

  .appliances-indicator {
    position: relative;
    width: 40px;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-full);
    overflow: hidden;
    cursor: pointer;
    transition: all var(--transition-base);
  }

  .appliances-indicator:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  .appliances-indicator-fill {
    position: absolute;
    inset: 0;
    background: linear-gradient(90deg, var(--primary), var(--primary-light));
    border-radius: var(--radius-full);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .appliances-indicator.active .appliances-indicator-fill {
    transform: scaleX(1);
  }

  /* Responsive */
  @media (max-width: 1023px) {
    .appliances-nav {
      display: none;
    }

    .appliance-inner {
      grid-template-columns: 1fr;
      min-height: auto;
    }

    .appliance-content {
      padding: var(--space-xl);
      order: 2;
    }

    .appliance-image {
      order: 1;
    }

    .appliance-image-inner {
      min-height: 280px;
    }
  }

  @media (max-width: 719px) {
    .section-appliances {
      padding: var(--space-3xl) 0;
    }

    .appliances-header {
      margin-bottom: var(--space-2xl);
    }

    .appliance-slide {
      flex: 0 0 calc(100vw - 2rem);
    }

    .appliances-track {
      padding: 0 var(--space-md);
      gap: var(--space-md);
    }

    .appliance-content {
      padding: var(--space-lg);
    }

    .appliance-image-inner {
      min-height: 220px;
    }

    .appliance-icon {
      width: 80px;
      height: 80px;
    }

    .appliances-indicator {
      width: 24px;
    }

    .appliances-progress {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-sm);
    }

    .appliances-progress-track {
      width: 100%;
    }
  }

  /* Reduced Motion */
  @media (prefers-reduced-motion: reduce) {
    .appliance-float-1,
    .appliance-float-2 {
      animation: none;
    }

    .appliances-header,
    .appliance-slide {
      opacity: 1;
      transform: none;
    }

    .appliance-inner,
    .appliance-image-inner,
    .appliance-icon,
    .appliances-indicator-fill,
    .appliances-progress-fill {
      transition: none;
    }
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  function initAppliancesSlider() {
    const section = document.querySelector('[data-appliances]');
    if (!section) return;

    const header = section.querySelector('[data-appliances-header]');
    const slider = section.querySelector('[data-appliances-slider]');
    const track = section.querySelector('[data-appliances-track]');
    const slides = section.querySelectorAll('[data-slide]');
    const prevBtn = section.querySelector('[data-nav-prev]');
    const nextBtn = section.querySelector('[data-nav-next]');
    const indicators = section.querySelectorAll('[data-indicator]');
    const progressFill = section.querySelector('[data-progress-fill]');
    const progressCurrent = section.querySelector('[data-progress-current]');

    let currentIndex = 0;
    const totalSlides = slides.length;

    // GSAP ScrollTrigger for section entry
    const tl = gsap.timeline({
      scrollTrigger: {
        trigger: section,
        start: 'top 80%',
        end: 'top 20%',
        toggleActions: 'play none none reverse',
      },
    });

    // Animate header
    tl.to(header, {
      opacity: 1,
      y: 0,
      duration: 0.8,
      ease: 'power3.out',
    });

    // Animate slides with stagger
    tl.to(slides, {
      opacity: 1,
      y: 0,
      duration: 0.8,
      stagger: 0.1,
      ease: 'power3.out',
    }, '-=0.4');

    // Update UI based on current index
    function updateUI() {
      // Update indicators
      indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentIndex);
      });

      // Update progress
      const progress = ((currentIndex + 1) / totalSlides) * 100;
      if (progressFill) {
        progressFill.style.width = `${progress}%`;
      }
      if (progressCurrent) {
        progressCurrent.textContent = String(currentIndex + 1).padStart(2, '0');
      }

      // Update nav buttons
      if (prevBtn) prevBtn.disabled = currentIndex === 0;
      if (nextBtn) nextBtn.disabled = currentIndex === totalSlides - 1;
    }

    // Scroll to slide
    function goToSlide(index: number) {
      if (index < 0 || index >= totalSlides) return;
      currentIndex = index;

      const slide = slides[index] as HTMLElement;
      if (slide && slider) {
        const sliderEl = slider as HTMLElement;
        const trackEl = track as HTMLElement;
        const slideOffset = slide.offsetLeft - trackEl.offsetLeft;
        const padding = parseFloat(getComputedStyle(trackEl).paddingLeft) || 0;
        
        sliderEl.scrollTo({
          left: slideOffset - padding,
          behavior: 'smooth',
        });
      }

      updateUI();
    }

    // Navigation handlers
    prevBtn?.addEventListener('click', () => goToSlide(currentIndex - 1));
    nextBtn?.addEventListener('click', () => goToSlide(currentIndex + 1));

    // Indicator clicks
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => goToSlide(index));
    });

    // Track scroll position for snap detection
    let scrollTimeout: ReturnType<typeof setTimeout>;
    slider?.addEventListener('scroll', () => {
      clearTimeout(scrollTimeout);
      scrollTimeout = setTimeout(() => {
        const sliderEl = slider as HTMLElement;
        const scrollLeft = sliderEl.scrollLeft;
        const trackEl = track as HTMLElement;
        const padding = parseFloat(getComputedStyle(trackEl).paddingLeft) || 0;

        // Find the closest slide
        let closestIndex = 0;
        let closestDistance = Infinity;

        slides.forEach((slide, index) => {
          const slideEl = slide as HTMLElement;
          const slideOffset = slideEl.offsetLeft - trackEl.offsetLeft - padding;
          const distance = Math.abs(scrollLeft - slideOffset);
          
          if (distance < closestDistance) {
            closestDistance = distance;
            closestIndex = index;
          }
        });

        if (closestIndex !== currentIndex) {
          currentIndex = closestIndex;
          updateUI();
        }
      }, 100);
    });

    // Keyboard navigation
    slider?.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        e.preventDefault();
        goToSlide(currentIndex - 1);
      } else if (e.key === 'ArrowRight') {
        e.preventDefault();
        goToSlide(currentIndex + 1);
      }
    });

    // Make slider focusable for keyboard
    slider?.setAttribute('tabindex', '0');
    slider?.setAttribute('role', 'region');
    slider?.setAttribute('aria-label', '가전제품 슬라이더');

    // Initialize UI
    updateUI();
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', initAppliancesSlider);
  
  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initAppliancesSlider);
</script>
