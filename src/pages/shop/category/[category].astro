---
/**
 * Dynamic Category Page
 * Displays products filtered by category with hero banner
 */

import Layout from '../../../layouts/Layout.astro';
import ShopNavbar from '../../../components/shop/ShopNavbar.astro';
import Breadcrumb from '../../../components/shop/Breadcrumb.astro';
import ProductGrid from '../../../components/shop/ProductGrid.astro';
import QuoteForm from '../../../components/shop/QuoteForm.astro';
import ShopFooter from '../../../components/shop/ShopFooter.astro';
import Toast from '../../../components/shop/Toast.astro';
import SearchOverlay from '../../../components/shop/SearchOverlay.astro';
import productsData from '../../../data/products.json';

export async function getStaticPaths() {
  const { categories, products } = productsData;
  return categories.map(cat => ({
    params: { category: cat.id },
    props: {
      category: cat,
      categoryProducts: products.filter(p => p.category === cat.id)
    }
  }));
}

const { category, categoryProducts } = Astro.props;
---

<Layout
  title={`${category.name} - issac.design Shop`}
  description={`${category.description}. ${category.name} 제품을 둘러보고 견적을 문의하세요.`}
>
  <script is:inline>document.body.classList.add('preloader-ready');</script>
  <ShopNavbar />
  <Toast />
  <SearchOverlay />

  <main class="category-page">
    <!-- Breadcrumb -->
    <div class="category-page__breadcrumb">
      <Breadcrumb items={[
        { label: category.name }
      ]} />
    </div>

    <!-- Category Hero Banner -->
    <section class="category-hero">
      <div class="category-hero__bg"></div>
      <div class="category-hero__container">
        <div class="category-hero__content">
          <span class="category-hero__label">카테고리</span>
          <h1 class="category-hero__title">{category.name}</h1>
          <p class="category-hero__description">{category.description}</p>
          <div class="category-hero__meta">
            <span class="category-hero__count">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                <rect x="1" y="1" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                <rect x="11" y="1" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                <rect x="1" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
                <rect x="11" y="11" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              <span>{categoryProducts.length}개 제품</span>
            </span>
            <a href="/shop#quote" class="category-hero__cta">
              <span>무료 견적 문의</span>
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M3 8h10M9 4l4 4-4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- Products Section -->
    <section class="category-products">
      <div class="category-products__container">
        <div class="category-products__header">
          <h2 class="category-products__title">{category.name} 제품 목록</h2>
          <p class="category-products__subtitle">
            총 <strong>{categoryProducts.length}</strong>개의 제품이 있습니다
          </p>
        </div>
        <ProductGrid products={categoryProducts} />
      </div>
    </section>

    <!-- Quote Section -->
    <section class="category-quote" id="quote">
      <div class="category-quote__container">
        <div class="category-quote__header">
          <h2 class="category-quote__title">맞춤 {category.name} 견적 문의</h2>
          <p class="category-quote__description">
            원하는 제품을 찾지 못하셨나요? 맞춤 제작도 가능합니다.
          </p>
        </div>
        <QuoteForm />
      </div>
    </section>
  </main>

  <ShopFooter />
</Layout>

<style>
  .category-page {
    position: relative;
    width: 100%;
    min-height: 100vh;
    background: var(--background);
  }

  /* Breadcrumb */
  .category-page__breadcrumb {
    padding-top: var(--header-height);
  }

  /* Category Hero */
  .category-hero {
    position: relative;
    width: 100%;
    padding: var(--space-4xl) 0;
    overflow: hidden;
  }

  .category-hero__bg {
    position: absolute;
    inset: 0;
    background: radial-gradient(
      ellipse at 30% 50%,
      rgba(26, 77, 46, 0.15) 0%,
      rgba(26, 77, 46, 0.05) 40%,
      transparent 70%
    );
    pointer-events: none;
  }

  .category-hero__container {
    position: relative;
    max-width: var(--container-max);
    margin: 0 auto;
    padding: 0 var(--container-padding);
  }

  .category-hero__content {
    max-width: 700px;
  }

  .category-hero__label {
    display: inline-block;
    padding: var(--space-xs) var(--space-md);
    background: rgba(26, 77, 46, 0.1);
    color: var(--primary);
    font-size: var(--font-size-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: var(--letter-spacing-wider);
    border-radius: var(--radius-full);
    border: 1px solid rgba(26, 77, 46, 0.2);
    margin-bottom: var(--space-lg);
  }

  .category-hero__title {
    font-size: var(--font-size-5xl);
    font-weight: 700;
    line-height: var(--line-height-tight);
    letter-spacing: var(--letter-spacing-tight);
    color: var(--text-primary);
    margin-bottom: var(--space-md);
  }

  .category-hero__description {
    font-size: var(--font-size-xl);
    color: var(--text-secondary);
    line-height: var(--line-height-relaxed);
    margin-bottom: var(--space-xl);
  }

  .category-hero__meta {
    display: flex;
    align-items: center;
    gap: var(--space-xl);
  }

  .category-hero__count {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: var(--font-size-sm);
    color: var(--text-muted);
  }

  .category-hero__count svg {
    color: var(--primary);
  }

  .category-hero__cta {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    padding: var(--space-sm) var(--space-lg);
    background: var(--primary);
    color: var(--text-primary);
    font-size: var(--font-size-sm);
    font-weight: 600;
    border-radius: var(--radius-md);
    transition: all var(--transition-base);
  }

  .category-hero__cta:hover {
    background: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(26, 77, 46, 0.3);
  }

  /* Products Section */
  .category-products {
    position: relative;
    width: 100%;
    padding: var(--space-2xl) 0 var(--space-4xl);
  }

  .category-products__container {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: 0 var(--container-padding);
  }

  .category-products__header {
    margin-bottom: var(--space-2xl);
    padding-bottom: var(--space-lg);
    border-bottom: 1px solid var(--border);
  }

  .category-products__title {
    font-size: var(--font-size-2xl);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--space-sm);
  }

  .category-products__subtitle {
    font-size: var(--font-size-sm);
    color: var(--text-secondary);
  }

  .category-products__subtitle strong {
    color: var(--primary);
    font-weight: 600;
  }

  /* Quote Section */
  .category-quote {
    position: relative;
    width: 100%;
    padding: var(--space-4xl) 0;
    background: var(--surface);
    border-top: 1px solid var(--border);
  }

  .category-quote__container {
    max-width: var(--container-max);
    margin: 0 auto;
    padding: 0 var(--container-padding);
  }

  .category-quote__header {
    text-align: center;
    margin-bottom: var(--space-2xl);
  }

  .category-quote__title {
    font-size: var(--font-size-3xl);
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--space-md);
  }

  .category-quote__description {
    font-size: var(--font-size-lg);
    color: var(--text-secondary);
  }

  /* Responsive - Tablet */
  @media (max-width: 1023px) {
    .category-hero {
      padding: var(--space-3xl) 0;
    }

    .category-hero__title {
      font-size: var(--font-size-4xl);
    }

    .category-hero__description {
      font-size: var(--font-size-lg);
    }
  }

  /* Responsive - Mobile */
  @media (max-width: 719px) {
    .category-page__breadcrumb {
      padding-top: var(--header-height-mobile);
    }

    .category-hero {
      padding: var(--space-2xl) 0;
    }

    .category-hero__title {
      font-size: var(--font-size-3xl);
    }

    .category-hero__description {
      font-size: var(--font-size-base);
    }

    .category-hero__meta {
      flex-direction: column;
      align-items: flex-start;
      gap: var(--space-md);
    }

    .category-hero__cta {
      width: 100%;
      justify-content: center;
    }

    .category-products__title {
      font-size: var(--font-size-xl);
    }

    .category-quote__title {
      font-size: var(--font-size-2xl);
    }
  }
</style>
